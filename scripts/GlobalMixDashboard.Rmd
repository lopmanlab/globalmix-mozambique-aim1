---
title: "Global Mix Mozambique Dashboard"
author: corssinojaime@gmail.com
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
        
---


```{r, echo = FALSE, warning = FALSE, message = FALSE, comment = NA, error= FALSE, cache = F}
library(knitr)
opts_chunk$set(comment = NA, 
               echo = FALSE, 
               warning = FALSE, 
               message = FALSE, 
               error = TRUE, 
               cache = FALSE)
```


```{r imports, echo=FALSE, warning=FALSE}
# Packages
library(ggplot2)

library(tidyr)
library(RColorBrewer)
library(dplyr)
library(leaflet)
library(ggthemes)
library(lubridate)
library(plotly)
library(knitr)
library(kableExtra)
options(knitr.table.format = "html") 
#define theme
theme_asart = ggthemes::theme_hc
library(forcats)
library(flexdashboard)

library(REDCapR)
library(redcapAPI)
library(dplyr)

data = rio::import("../dashboardfiles/data.csv")

```

```{r start_exec, echo=FALSE}

exit = data %>% dplyr::filter(redcap_event_name == "exit_interview_arm_1") %>% dplyr::select("rec_id","contacts_completedby","all_contacts","contact_compare","behavior_change","movement_change","days_left_home","activities___1","activities___2","activities___3","activities___4","activities___5","activities___6","activities___7","activities___8","activities_other","activities_work","activities_school","yesterday_left_home","quarantine","quarantine_behavior","self_isolation","self_isolation_location","self_isolation_home","self_isolation_away","isolation_ability","mask_use","mask_use_location___0","mask_use_location___1","mask_use_location___2","mask_use_location___3","mask_use_location___4","mask_use_location___5","mask_use_location___6","mask_use_location___7","mask_use_location_other","covid_contact___0","covid_contact___1","covid_contact___2","covid_contact___3","covid_contact___4","covid_contact___5","covid_contact___6","covid_contact___7","covid_contact_other","current_symptoms___0","current_symptoms___1","current_symptoms___2","current_symptoms___3","current_symptoms___4","current_symptoms___5","current_symptoms___6","current_symptoms___7","current_symptoms___8","current_symptoms___9","current_symptoms___10","current_symptoms___11","contact_with_infected","self_covid_test","family_covid","family_covid_symptoms","family_covid_test","family_covid_number","phone_access","phone_ownership","phone_function","phone_comm_mode","phone_provider___0","phone_provider___1","phone_provider___2","phone_provider___3","phone_provider_other","phone_signal","phone_use","entrevista_de_sada_complete")

exit = exit %>% dplyr::mutate(complbl = case_when(contacts_completedby == 0 ~ "alone during day 1 and 2",
                                                            contacts_completedby == 1 ~ "by fieldworker at collection day"))


diary_1 = data %>% dplyr::filter(redcap_event_name == "day_1_diary_arm_1") %>% dplyr::select("rec_id","redcap_repeat_instance","redcap_repeat_instrument","shadow_d1","shadow_name_d1","shadow_gender_d1","shadow_age_d1","shadow_gender_other_d1","shadow_relationship_d1","shadow_relationship_other_d1","interview_date_d1","survey_date_d1","survey_day_d1","aim_day1","hh_day1","num_contact_aim1_d1","num_contact_nonhh_aim1_d1","num_contact_aim2_d1","num_contact_nonhh_aim2_d1","dirio_de_contato_dia_1_metadata_complete","dirio_de_contato_dos_membros_da_familia_dia_1_timestamp","contact_id_d1_hh_1","touch_contact_d1_hh_1","where_contact_d1_hh_1","location_contact_d1_hh_1___0") %>% dplyr::filter(redcap_repeat_instrument == "")

## = c("Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado","Domingo")
wkdays = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")

diary_1 = diary_1 %>% dplyr::mutate(sd1 = case_when(survey_day_d1 == 0 ~ wkdays[1], survey_day_d1 == 1 ~ wkdays[2], survey_day_d1 == 2 ~ wkdays[3], survey_day_d1 == 3 ~ wkdays[4],
                                                    survey_day_d1 == 4 ~ wkdays[5], survey_day_d1 == 5 ~ wkdays[6], survey_day_d1 == 6 ~ wkdays[7]))

diary_1$sd1 = factor(diary_1$sd1, levels = c(wkdays[1:7]))
                                             

locs_d1 = data %>% dplyr::filter(redcap_repeat_instrument == "dirio_de_locais_visitados_dia_1") %>% dplyr::select("rec_id","redcap_repeat_instance","redcap_repeat_instrument","place_name_d1","place_visited_d1","place_visited_d1_other","num_pax_place_d1","time_visited_d1","visited_frequency_d1","dirio_de_locais_visitados_dia_1_complete")

cont_d1 = data %>% dplyr::filter(redcap_repeat_instrument == "dirio_de_contato_dia_1") %>% dplyr::select("rec_id","redcap_repeat_instance","redcap_repeat_instrument","contact_id_d1","contact_hhmember_d1","contact_hhmember_id_d1","contact_age_yn_d1","age_contact_d1","age_group_contact_d1","sex_contact_d1","touch_contact_d1","where_contact_d1","location_contact_d1___0","location_contact_d1___1","location_contact_d1___2","location_contact_d1___3","location_contact_d1___4","location_contact_d1___5","location_contact_d1___6","location_contact_d1___7","location_contact_d1___8","location_contact_d1___9","location_contact_d1___10","location_contact_d1___11","location_contact_other_d1","contact_mask_d1","duration_contact_d1","frequency_contact_d1","known_contact_d1","dirio_de_contato_dia_1_complete")

d1_conts = merge(diary_1, cont_d1, by = "rec_id")
d1_locs = merge(diary_1, locs_d1, by = "rec_id")


diary_2 = data %>% dplyr::filter(redcap_event_name == "day_2_diary_arm_1") %>% dplyr::select("rec_id","redcap_repeat_instance","redcap_repeat_instrument","shadow_d2","shadow_name_d2","shadow_age_d2","shadow_gender_d2","shadow_gender_other_d2","shadow_relationship_d2","shadow_relationship_other_d2","survey_date_d2","survey_day_d2","aim_day2","hh_day2","num_contact_aim1_d2","num_contact_nonhh_aim1_d2","num_contact_aim2_d2","num_contact_nonhh_aim2_d2","dirio_de_contato_dia_2_metadata_complete","dirio_de_contato_dos_membros_da_familia_dia_2_timestamp","contact_id_d2_hh_1","touch_contact_d2_hh_1","where_contact_d2_hh_1","location_contact_d2_hh_1___0") %>% dplyr::filter(redcap_repeat_instrument == "")

diary_2 = diary_2 %>% dplyr::mutate(sd2 = case_when(survey_day_d2 == 0 ~ wkdays[1], survey_day_d2 == 1 ~ wkdays[2], survey_day_d2 == 2 ~ wkdays[3], survey_day_d2 == 3 ~ wkdays[4],
                                                    survey_day_d2 == 4 ~ wkdays[5], survey_day_d2 == 5 ~ wkdays[6], survey_day_d2 == 6 ~ wkdays[7]))

diary_2$sd2 = factor(diary_2$sd2, levels = c(wkdays[1:7]))


locs_d2 = data %>% dplyr::filter(redcap_repeat_instrument == "dirio_de_locais_visitados_dia_2") %>% dplyr::select("rec_id","redcap_repeat_instance","redcap_repeat_instrument","place_name_d2","place_visited_d2","place_visited_d2_other","num_pax_place_d2","time_visited_d2","visited_frequency_d2","dirio_de_locais_visitados_dia_2_complete")

cont_d2 = data %>% dplyr::filter(redcap_repeat_instrument == "dirio_de_contato_dia_2") %>% dplyr::select("rec_id","redcap_repeat_instance","redcap_repeat_instrument","contact_id_d2","contact_age_yn_d2","age_contact_d2","age_group_contact_d2","sex_contact_d2","sex_contact_other_d2","touch_contact_d2","where_contact_d2","location_contact_d2___0","location_contact_d2___1","location_contact_d2___2","location_contact_d2___3","location_contact_d2___4","location_contact_d2___5","location_contact_d2___6","location_contact_d2___7","location_contact_d2___8","location_contact_d2___9","location_contact_d2___10","location_contact_d2___11","location_contact_other_d2","contact_mask_d2","duration_contact_d2","frequency_contact_d2","known_contact_d2","dirio_de_contato_dia_2_complete")

d2_conts = merge(diary_2, cont_d2, by = "rec_id")
d2_locs = merge(diary_2, locs_d2, by = "rec_id")

diaries = merge(diary_1, diary_2, by = "rec_id")

diaries = diaries %>% dplyr::mutate(shd1 = case_when(shadow_d1 == 0 ~ "Participant",
                                                     shadow_d1 == 1 ~ "Shadow"),
                                    shd2 = case_when(shadow_d2 == 0 ~ "Participant",
                                                     shadow_d2 == 1 ~ "Shadow"),)


#ex = data %>% dplyr::filter(redcap_event_name == "exit_interview_arm_1")

###############household data ################################################ 


hh = data %>% dplyr::filter(redcap_event_name == "household_survey_arm_1") %>% dplyr::select("rec_id","redcap_repeat_instrument","redcap_repeat_instance","redcap_survey_identifier","site_do_estudo_timestamp","individual_id","interview_date","enumerator_id100","study_site","aim","hh","site_do_estudo_complete","informaes_de_agregado_familiar_e_casa_timestamp","hh_id","hoh_id","date_hohconsent","hh_head_gender","hh_head_gender_other","hh_occupants","hh_slept","hh_room_num","hh_bedroom_num","hh_roof_material","hh_roof_material_other","hh_wall_material","hh_wall_material_other","hh_ac","hh_fan","hh_amenities___0","hh_amenities___1","hh_amenities___2","hh_amenities___3","hh_amenities___4","hh_transport___0","hh_transport___1","hh_transport___2","hh_transport___3","hh_transport___4","hh_grazing","hh_poultry","hh_pig","hh_improvements","animal_touch___0","animal_touch___1","animal_touch___2","animal_touch___3","animal_touch___4","animal_touch___5","animal_touch___6","animal_touch___7","animal_touch___8","animal_touch_other","animal_injury___0","animal_injury___1","animal_injury___2","animal_injury___3","animal_injury___4","animal_injury___5","animal_injury___6","animal_injury___7","animal_injury___8","animal_injury_other","animal_cook___0","animal_cook___1","animal_cook___2","animal_cook___3","animal_cook___4","animal_cook___5","animal_cook___6","animal_cook___7","animal_cook___8","animal_cook_other","water_source___0","water_source___1","water_source___2","water_source___3","water_source___4","water_source___5","water_source___6","water_source___7","water_source___8","water_source___9","water_source___10","water_source___11","water_source_other","water_drink___0","water_drink___1","water_drink___2","water_drink___3","water_drink___4","water_drink___5","water_drink___6","water_drink___7","water_drink___8","water_drink___9","water_drink___10","water_drink___11","water_drink_other","water_purify","water_purify_method___1","water_purify_method___2","water_purify_method___3","water_purify_method___4","water_purify_method___5","water_purify_method___6","water_purify_method___7","water_purify_method___8","water_purify_method_other","wash_hands_defecate","wash_hands_food","wash_hands_toilet","hh_toilet","hh_toilet_other","hh_toilet_location","hh_toilet_location_other","child_stool_disposal","child_stool_disposal_other","hh_smoking","hh_cook","hh_fuel___0","hh_fuel___1","hh_fuel___2","hh_fuel___3","hh_fuel_other","hh_asthma","hh_tb","informaes_de_agregado_familiar_e_casa_complete","informaes_sobre_os_membros_da_famlia_timestamp") %>% dplyr::filter(redcap_repeat_instrument == "")

hh = hh %>% mutate(study_sitelb = case_when(study_site == 1 ~ "Manhiça",
                                            study_site == 2 ~ "Polana Caniço"))

hh = hh %>% dplyr::mutate(genderlb = case_when(hh_head_gender == 0 ~ "Female",
                                              hh_head_gender == 1 ~ "Male"))

############################################################### 


#################Family members########################## 

ind_rep = data %>% dplyr::filter(redcap_repeat_instrument == "informaes_sobre_os_membros_da_famlia") %>% dplyr::select("rec_id", "redcap_repeat_instrument", "redcap_repeat_instance","hh_member_hoh","hh_member_name","hh_member_id","hh_member_sensor","hh_member_sex","hh_member_sex_outro","hh_member_age","hh_member_relationship","hh_member_relationship_other","share_room","share_bed","cook_food","hh_member_hhform","hh_member_instance","informaes_sobre_os_membros_da_famlia_complete","inscrio_timestamp")

############################################################### 


######################### Recruited participants #####################
ind = data %>% dplyr::filter(redcap_event_name == "individual_enrollm_arm_1") %>% dplyr::select("rec_id", "redcap_event_name", "date_enrolled", "name", "sensor_id", "sex", "sex_other","birthdate", "age", "read_write", "address", "telephone", "telephone_1", "occupation___0", "occupation___1", "occupation___2", "occupation___3", "occupation___4", "occupation___5", "occupation___6", "occupation___7", "occupation___8", "occupation___9", "occupation_other", "enrolled_school", "highest_educ", "school_level", "transport_use", "hh_resp_exposure", "child", "child_breastfeed", "child_breastfeed2", "child_breastfeed3___1", "child_breastfeed3___2", "child_breastfeed3___3", "child_breastfeed3___4", "child_breastfeed3___5", "child_breastfeed3___6", "child_breastfeed3___7", "child_breastfeed3___8", "child_breastfeed3___9", "child_breastfeed3___10", "child_breastfeed3___11", "child_breastfeed3_other", "num_simbling", "inscrio_complete")


ind  = ind %>% dplyr::mutate(highest_educlb = case_when(highest_educ == 0 ~ "No schooling", highest_educ == 1 ~ "Primary School (1-7)", highest_educ == 1 ~ "Basic Secondary school (8-10)",
                                                        highest_educ == 1 ~ "Middle Secondary (11-12)", highest_educ == 1 ~ "1-3 years of college/university", highest_educ == 5 ~ "Bacherols",
                                                        highest_educ == 6 ~ "More than Bacherols"))

############################################################### 

#indnull = df_hhind[is.na(df_hhind$birthdate),]
#indnull$birthdate = x$date_enrolled %m-%years(x$age)
#ind = ind[!is.na(ind$birthdate),]
#ind = rbind(indnull, ind)
#indnull = indnull %>% dplyr::select(rec_id, redcap_event_name,individual_id,study_sitelb,date_enrolled,name,sensor_id, birthdate,age)
#rio::export(indnull, "./missing_dob.xlsx")

ind$age_weeks = round(difftime(strptime(as.Date(ind$date_enrolled), format = "%Y-%m-%d"),strptime(ind$birthdate, format = "%Y-%m-%d"),units="weeks"),2)
ind$months = interval(ind$birthdate,ind$date_enrolled) %/% months(1) 
df_mths = subset(ind, ind$months < 12)
df_years = subset(ind, ind$months >= 12)
df_mths = df_mths %>% dplyr::mutate(group = case_when(months < 6 ~ 1, months >= 6  ~ 2))
df_years = df_years %>% dplyr::mutate(group = case_when( age < 5 ~ 3, age >= 5 & age < 10 ~ 4, age >= 10 & age < 15 ~ 5, age >= 15 & age < 20 ~ 6, age >= 20 & age < 30 ~ 7, age >= 30 & age < 40 ~ 8,
                                                         age >= 40 & age < 60 ~ 9, age >= 60 ~ 10))
ind = rbind(df_mths, df_years)

ind = ind %>% dplyr::mutate(agelb = case_when(group == 1 ~ "< 6months", group == 2 ~ "6 - 11months", group == 3 ~ "1 - 4y", group == 4 ~ "5 - 9y", group == 5 ~ "10 - 14y", group == 6 ~ "15 - 19y", 
                                              group == 7 ~ "20 - 29y", group == 8 ~ "30 - 39y", group == 9 ~ "40 - 59y", group == 10 ~ "60y+"))

#ind = ind %>% dplyr::mutate(agelb = case_when(age < 1 ~ "<1", age >=1 & age <= 4 ~ "1 - 4y", age >=5 & age <=9 ~ "5 - 9y", age >=10 & age <=14 ~ "10 - 14y", age >=15 & age <=19 ~ "15 - 19y", 
#                                              age >=20 & age <=29 ~ "20 - 29y", age >=30 & age <=39 ~ "30 - 39y", age >=40 & age <=59 ~ "40 - 59y", age >=60 ~ "60y+"))

ind = ind %>% dplyr::mutate(sexlb = case_when(sex == 0 ~ "Female", sex == 1 ~ "Male"))

#ind$agelb = factor(ind$agelb, levels = c("<1", "1 - 4y", "5 - 9y", "10 - 14y", "15 - 19y", "20 - 29y", "30 - 39y", "40 - 59y", "60y+"))


ind$agelb = factor(ind$agelb, levels = c("< 6months","6 - 11months", "1 - 4y", "5 - 9y", "10 - 14y", "15 - 19y", "20 - 29y", "30 - 39y", "40 - 59y", "60y+"))


pl_lbs = c("My home", "Other home", "School", "Work", "Transport/ Hub", "Market", "Street", "Well", "Playground", "Shop", "Place of worship", "Garden", "Other")

ind_locs1 = merge(ind, d1_locs, by="rec_id")
ind_cont1 = merge(ind, d1_conts, by="rec_id")
ind_cont1 = merge(ind_cont1, hh, by="rec_id")

ind_locs1 = ind_locs1 %>% dplyr::mutate(p_d1 = case_when(place_visited_d1 == 0 ~ pl_lbs[1], place_visited_d1 == 1 ~ pl_lbs[2], place_visited_d1 == 2 ~ pl_lbs[3], place_visited_d1 == 3 ~ pl_lbs[4],place_visited_d1 == 4 ~ pl_lbs[5], place_visited_d1 == 5 ~ pl_lbs[6], place_visited_d1 == 6 ~ pl_lbs[7], place_visited_d1 == 7 ~ pl_lbs[8],
                                                 place_visited_d1 == 8 ~ pl_lbs[9], place_visited_d1 == 9 ~ pl_lbs[10], place_visited_d1 == 10 ~ pl_lbs[11], place_visited_d1 == 11 ~ pl_lbs[12],
                                                 place_visited_d1 == 12 ~ pl_lbs[13]))

ind_locs2 = merge(ind, d2_locs, by="rec_id")
ind_cont2 = merge(ind, d2_conts, by="rec_id")
ind_cont2 = merge(ind_cont2, hh, by="rec_id")

ind_locs2 = ind_locs2 %>%  dplyr::mutate(p_d1 = case_when(place_visited_d2 == 0 ~ pl_lbs[1], place_visited_d2 == 1 ~ pl_lbs[2], place_visited_d2 == 2 ~ pl_lbs[3], place_visited_d2 == 3 ~ pl_lbs[4],place_visited_d2 == 4 ~ pl_lbs[5], place_visited_d2 == 5 ~ pl_lbs[6], place_visited_d2 == 6 ~ pl_lbs[7], place_visited_d2 == 7 ~ pl_lbs[8],
                                                 place_visited_d2 == 8 ~ pl_lbs[9], place_visited_d2 == 9 ~ pl_lbs[10], place_visited_d2 == 10 ~ pl_lbs[11], place_visited_d2 == 11 ~ pl_lbs[12],
                                                 place_visited_d2 == 12 ~ pl_lbs[13]))


df_hhind = merge(ind, hh, by = "rec_id")

################## individuals with sensor_id #####################

ss_ind = df_hhind %>% 
  #dplyr::select(rec_id,redcap_event_name, date_enrolled, name,sensor_id, agelb,sexlb,study_sitelb) %>% 
  #dplyr::mutate(n  = nchar(sensor_id)) %>% 
  dplyr::filter(nchar(sensor_id) == 8)

#################################################

df_ir = merge(ind_rep, hh, by = "rec_id")


######################### hh_member_sensor #################

ss_df_ir = df_ir %>% ## dplyr::select(rec_id, hh_member_hoh, hh_member_name, hh_member_id, hh_member_sensor, hh_member_age,hh_member_sex,genderlb, study_site, study_sitelb) %>% 
  dplyr::filter(nchar(hh_member_sensor) == 8)

##############################################



diary_1 = merge(diary_1, df_hhind, by = "rec_id")
diary_2 = merge(diary_2, df_hhind, by = "rec_id")

ex_hh = merge(exit, hh, by = "rec_id")
ex_hh_ind = merge(ex_hh, ind, by = "rec_id")

################## exit individuals with sensor_id #####################

ss_ex_hh_ind = ex_hh_ind %>% dplyr::filter(nchar(sensor_id) == 8)


#################################################


#exit$exist = exit$rec_id%in%hh$rec_id
#exit$exist = exit$rec_id%in%cont_d1$rec_id

#### y = subset(ex_hh_ind, !ex_hh_ind$rec_id%in%diaries$rec_id) exit surveys with no diaries

ex_diaries = merge(ex_hh_ind, diaries, by = "rec_id")

##x = dplyr::anti_join(diaries, ex_hh_ind, by = "rec_id")

ex_contacts1 = merge(cont_d1, ex_hh_ind, by = "rec_id")
ex_contacts2 = merge(cont_d2, ex_hh_ind, by = "rec_id")


```


Overview {data-icon="fa-globe"}
=====================================  


Row
-----------------------------------------------------------------------

### Data Related to

```{r}
valueBox("Data related to", paste0(format(Sys.time(), '%d %B, %Y - %H:%M:%S'), '. Time Zone : ',Sys.timezone()), icon = "fa-calendar", color = 'black', href = "#apes")

```

### Recruitment Rate
```{r}
gauge(round(dim(df_hhind)[1]/1260 * 100,2), min = 0, max = 1260, symbol = '%', gaugeSectors(success = c(80, 100), warning = c(40, 79), danger = c(0, 39)))

```


### Number of Individual Enrollment

```{r}
###fa-list, fa-pen
  
valueBox(dim(df_hhind)[1], icon = "fa-analytics", color = 'danger', href = "#apes")

```

### Household Members

```{r}
valueBox(dim(df_ir)[1], icon = "fa-users", color = 'info', href = "#informantes")
```


### Exit Survey

```{r}
valueBox(dim(ex_hh_ind)[1], icon = "fa-arrow-up", color = "green", href = "#exit_s")
```




### Participants with Sensor

```{r}
valueBox(dim(ss_ind)[1], icon = "fa-stethoscope", color = "warning", href = "#observacao")
```



Row
----------------------------------------------------------------------


### Participants (NOT) recruited by age category

```{r}
#x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) 
#x$week = strftime(x$date_enrolled, format = "%Y-W%V")
#x = x %>% group_by(week,agelb) %>% dplyr::summarise(total = n())
#x = x %>% group_by(agelb) %>% dplyr::arrange(week)%>% dplyr::mutate(cs = cumsum(total))
#x %>% plotly::plot_ly(x=~week, y=~total,  color=~agelb, type = 'scatter', mode= 'line', colors = 'Accent') %>%
#  plotly::layout(xaxis = list(title= 'Week Number'), yaxis = list(title='total'))

x = ex_hh_ind %>% dplyr::select(sexlb,agelb, study_site,study_sitelb) %>% dplyr::filter(study_site == 1) %>% 
  group_by(agelb) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(targ = (63*2) - total, perc = paste0(round(total/63*2*100, 2), "%") )

dur = interval(min(ex_hh_ind$interview_date),Sys.Date()) %/% months(1) 

x %>% plotly::plot_ly(x=~agelb, y=~total, type = 'bar', colors = 'Accent', name = 'Diary Completed') %>%
  plotly::add_trace(y=~targ, name= 'Not Enrolled') %>% 
  plotly::add_text(text =~perc, textposition = 'auto', name= 'Show Percentages') %>% 
  plotly::layout(xaxis = list(title= 'Age Group'),yaxis = list(title='Total'), barmode = 'stack')%>% 
  plotly::add_trace(y=dur*14, type = 'scatter', mode = 'lines+markers', name = "Target", line = list(color = 'blue'))

```

### Participants recruited (Cumulative) by age category

```{r}

x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) 
x$week = strftime(x$date_enrolled, format = "%Y-W%V")
x = x %>% group_by(week,agelb) %>% dplyr::summarise(total = n())
x = x %>% group_by(agelb) %>% dplyr::arrange(week)%>% dplyr::mutate(cs = cumsum(total))


x %>% plotly::plot_ly(x=~week, y=~cs,  color=~agelb, type = 'scatter', mode= 'line', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Week Number'),yaxis = list(title='total'))

```


Row
----------------------------------------------------------------------

### Enrollment vs Exit Survey (Manhiça)

```{r}

enr = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) %>% dplyr::filter(study_site == 1) %>% 
  group_by(study_sitelb) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(id = "target")
enr$total = 630

ex = ex_hh_ind %>% dplyr::select(sexlb,agelb, study_site,study_sitelb) %>% dplyr::filter(study_site == 1) %>% 
  group_by(study_sitelb) %>% dplyr::summarise(total = n())%>% dplyr::mutate(id = "completed")

x = rbind(enr,ex)

x %>% plotly::plot_ly(labels = ~id, values=~total, color=~study_sitelb, type = 'pie', text =~total, texttemplate = '<b>%{value}</br></br>%{percent}</b>', 
             textfont = list(color = '#000000')) %>% 
  layout(title = 'Enrollment Vs Exit Survey (Manhiça)',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```



### Enrollment vs Exit Survey (Polana Caniço)

```{r}

enr = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) %>% dplyr::filter(study_site == 2) %>% 
  group_by(study_sitelb) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(id = "target")
enr$total = 630
ex = ex_hh_ind %>% dplyr::select(sexlb,agelb, study_site,study_sitelb) %>% dplyr::filter(study_site == 2) %>% 
  group_by(study_sitelb) %>% dplyr::summarise(total = n())%>% dplyr::mutate(id = "completed")

x = rbind(enr,ex)

x %>% plotly::plot_ly(labels = ~id, values=~total, color=~study_sitelb, type = 'pie', text =~total, texttemplate = '<b>%{value}</br></br>%{percent}</b>', 
             textfont = list(color = '#000000')) %>%  
  layout(title = 'Enrollment Vs Exit Survey (Polana Caniço)',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

Row
----------------------------------------------------------------------

### Enrollment by Gender

```{r}
x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) 
x = x %>% group_by(sexlb,agelb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~total,  color=~sexlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Age Group'), yaxis = list(title='total'))

```

Row
----------------------------------------------------------------------


### Total of enrollment by weekdays 

```{r}
x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) %>% 
  dplyr::mutate(dw = weekdays(date_enrolled)) %>% 
  dplyr::group_by(study_sitelb, dw) %>% dplyr::summarise(total = n())

x$dw = factor(x$dw, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

x %>% plotly::plot_ly(x=~dw, y=~total,  color=~study_sitelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Week day'), yaxis = list(title='total'))

#x = reshape2::dcast(x, study_sitelb ~ dw, value.var = "total")
#x = x %>% dplyr::select(study_sitelb, Monday, Tuesday, Wednesday, Thursday, Friday) %>% rename("study site" = study_sitelb)

```



```{r eval=FALSE}
### Age of household individuals by site

library('plotly')
df = df_ir %>% dplyr::select(study_sitelb, hh_member_age)
df$study_sitelb = as.factor(df$study_sitelb)
df %>% plotly::plot_ly(x=~study_sitelb, y=~hh_member_age,  color=~study_sitelb, type = 'box',colors = 'Accent') %>% plotly::layout(xaxis = list(title= 'Study Site'), 
                                                                                                                                   yaxis = list(title='Age'))


```



Row
-----------------------------------------------------------------------

### Dataset with plans (Next visit, missing visit and so on)




Manhiça Site 
===================================== 

Row
-----------------------------------------------------------------------

### Number of Individual Enrollment

```{r}
###fa-list, fa-pen

valueBox(dim(df_hhind %>% dplyr::filter(study_site == 1))[1], icon = "fa-home", color = 'danger', href = "#apes")
```

### Recruitment Rate
```{r}
gauge(round(dim(df_hhind%>% dplyr::filter(study_site == 1))[1]/630 * 100,2), min = 0, max = 630, symbol = '%', gaugeSectors(success = c(80, 100), warning = c(40, 79), danger = c(0, 39)))

```

### Household Members

```{r}
valueBox(dim(df_ir %>% dplyr::filter(study_site == 1))[1], icon = "fa-users", color = 'info', href = "#informantes")
```

### Participants with Sensor

```{r}
valueBox(dim(ss_ind %>% dplyr::filter(study_site ==1))[1], icon = "fa-stethoscope", color = "warning", href = "#observacao")
```


Row
----------------------------------------------------------------------


### Participants (NOT) recruited by age category

```{r}
#x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb)  %>% dplyr::filter(study_site == 1)
#x$week = strftime(x$date_enrolled, format = "%Y-W%V")
#x = x %>% group_by(week,agelb) %>% dplyr::summarise(total = n())
#x = x %>% group_by(agelb) %>% dplyr::arrange(week)%>% dplyr::mutate(cs = cumsum(total))

#x %>% plotly::plot_ly(x=~week, y=~total,  color=~agelb, type = 'scatter', mode= 'line', colors = 'Accent') %>%
#  plotly::layout(xaxis = list(title= 'Week Number'), yaxis = list(title='total'))


x = ex_hh_ind %>% dplyr::select(sexlb,agelb, study_site,study_sitelb) %>% dplyr::filter(study_site == 1) %>% 
  group_by(agelb) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(targ = 63 - total, perc = paste0(round(total/63*100, 2), "%") )

x %>% plotly::plot_ly(x=~agelb, y=~total, type = 'bar', colors = 'Accent', name = 'Diary Completed') %>%
  plotly::add_trace(y=~targ,  name= 'Not Enrolled') %>% 
  plotly::add_text(text =~perc, textposition = 'auto', name= 'Show Percentages') %>% 
  plotly::layout(xaxis = list(title= 'Age Group'),yaxis = list(title='Total'), barmode = 'stack')

```

### Participants recruited (Cumulative) by age category

```{r}
x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb)  %>% dplyr::filter(study_site == 1)
x$week = strftime(x$date_enrolled, format = "%Y-W%V")
x = x %>% group_by(week,agelb) %>% dplyr::summarise(total = n())
x = x %>% group_by(agelb) %>% dplyr::arrange(week)%>% dplyr::mutate(cs = cumsum(total))


x %>% plotly::plot_ly(x=~week, y=~cs,  color=~agelb, type = 'scatter', mode= 'line', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Week Number'),yaxis = list(title='total'))


```

Row
----------------------------------------------------------------------

### Enrollment by Gender

```{r}
x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb)  %>% dplyr::filter(study_site == 1)
x = x %>% group_by(sexlb,agelb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~total,  color=~sexlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Age Group'), yaxis = list(title='total'))

```


Polana Caniço Site {data-icon="fa-city"}
===================================== 

Row
-----------------------------------------------------------------------

### Number of Individual Enrollment

```{r}
###fa-list, fa-pen

valueBox(dim(df_hhind %>% dplyr::filter(study_site == 2))[1], icon = "fa-analytics", color = 'danger', href = "#apes")
```

### Recruitment Rate

```{r}
gauge(round(dim(df_hhind%>% dplyr::filter(study_site == 2))[1]/630 * 100,2), min = 0, max = 630, symbol = '%', gaugeSectors(success = c(80, 100), warning = c(40, 79), danger = c(0, 39)))

```


### Household Members

```{r}
valueBox(dim(df_ir %>% dplyr::filter(study_site == 2))[1], icon = "fa-users", color = 'info', href = "#informantes")
```

### Participants with Sensor

```{r}
valueBox(dim(ss_ind %>% dplyr::filter(study_site ==2))[1], icon = "fa-stethoscope", color = "warning", href = "#observacao")
```



Row
----------------------------------------------------------------------


### Participants (NOT) recruited by age category

```{r}
#x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) %>% dplyr::filter(study_site == 2)
#x$week = strftime(x$date_enrolled, format = "%Y-W%V")
#x = x %>% group_by(week,agelb) %>% dplyr::summarise(total = n())
#x = x %>% group_by(agelb) %>% dplyr::arrange(week)%>% dplyr::mutate(cs = cumsum(total))

#x %>% plotly::plot_ly(x=~week, y=~total,  color=~agelb, type = 'scatter', mode= 'line', colors = 'Accent') %>%
#  plotly::layout(xaxis = list(title= 'Week Number'), yaxis = list(title='total'))


x = ex_hh_ind %>% dplyr::select(sexlb,agelb, study_site,study_sitelb) %>% dplyr::filter(study_site == 2) %>% 
  group_by(agelb) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(targ = 63 - total,perc = paste0(round(total/63*100, 2), "%") )

x %>% plotly::plot_ly(x=~agelb, y=~total, type = 'bar', colors = 'Accent', name = 'Diary Completed') %>%
  plotly::add_trace(y=~targ, name= 'Not Enrolled') %>% 
   plotly::add_text(text =~perc, textposition = 'auto', name= 'Show Percentages') %>% 
  plotly::layout(xaxis = list(title= 'Age Group'),yaxis = list(title='Total'), barmode = 'stack')


```

### Participants recruited (Cumulative) by age category

```{r}
x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb) %>% dplyr::filter(study_site == 2)
x$week = strftime(x$date_enrolled, format = "%Y-W%V")
x = x %>% group_by(week,agelb) %>% dplyr::summarise(total = n())
x = x %>% group_by(agelb) %>% dplyr::arrange(week)%>% dplyr::mutate(cs = cumsum(total))


x %>% plotly::plot_ly(x=~week, y=~cs,  color=~agelb, type = 'scatter', mode= 'line', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Week Number'),yaxis = list(title='total'))

```

Row
----------------------------------------------------------------------

### Enrollment by Gender

```{r}
x = df_hhind %>% dplyr::select(sexlb,agelb, date_enrolled,read_write,telephone,study_site,study_sitelb)  %>% dplyr::filter(study_site == 2)
x = x %>% group_by(sexlb,agelb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~total,  color=~sexlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Age Group'), yaxis = list(title='total'))

```


Row
----------------------------------------------------------------------

Exit Survey {data-icon="fa-arrow-up"}
===================================== 

Row
-----------------------------------------------------------------------

### Number of participants with Exit Survey

```{r}
###fa-list, fa-pen

valueBox(dim(ex_hh_ind)[1], icon = "fa-arrow-up", color = "green", href = "#exit_s")
```

### Exit Survey with Sensor

```{r}
valueBox(dim(ss_ex_hh_ind)[1], icon = "fa-stethoscope", color = "warning", href = "#observacao")
```

Row
-----------------------------------------------------------------------

### Number of completed diaries by age group
```{r}
x = ex_hh_ind %>% dplyr::select(rec_id,sexlb,agelb, study_site,study_sitelb) %>% 
  group_by(study_sitelb,agelb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~total,  color=~study_sitelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Age Group'),yaxis = list(title='Total'))


```


### Description of who filled the diary in exit survey

```{r}
x = ex_diaries %>% dplyr::select(shadow_d1, shadow_d2,shd1,shd2)
d1 = x %>% dplyr::group_by(shd1) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(id = "day_1")
d2 = x %>% dplyr::group_by(shd2) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(id = "day_2") %>% dplyr::rename(shd1 = shd2)

x = rbind(d1,d2)

x %>% plotly::plot_ly(x=~id, y=~total,  color=~shd1, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Age Group'),yaxis = list(title='Total'))


```

Row
-----------------------------------------------------------------------

### Occupation vs Gender
```{r}

#oc_lbs = c("Desempregado", "Estudante", "Trabalho formal", "Negociante", "Trabalho casual", "Agricultor", "Pescador", "Reformado", "Domestico", "Outro")
oc_lbs = c("Unemployed", "Student", "Office worker", "Business person", "Casual labour", "Farmer", "Fishing", "Retired", "Homemaker/ Housewife", "Other")

oc0 = ex_diaries %>%  dplyr::select(rec_id,occupation___0,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___0)) %>% dplyr::mutate(id = oc_lbs[1])
oc1 = ex_diaries %>%  dplyr::select(rec_id,occupation___1,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___1)) %>% dplyr::mutate(id = oc_lbs[2])
oc2 = ex_diaries %>%  dplyr::select(rec_id,occupation___2,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___2)) %>% dplyr::mutate(id = oc_lbs[3])
oc3 = ex_diaries %>%  dplyr::select(rec_id,occupation___3,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___3)) %>% dplyr::mutate(id = oc_lbs[4])
oc4 = ex_diaries %>%  dplyr::select(rec_id,occupation___4,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___4)) %>% dplyr::mutate(id = oc_lbs[5])
oc5 = ex_diaries %>%  dplyr::select(rec_id,occupation___5,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___5)) %>% dplyr::mutate(id = oc_lbs[6])
oc6 = ex_diaries %>%  dplyr::select(rec_id,occupation___6,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___6)) %>% dplyr::mutate(id = oc_lbs[7])
oc7 = ex_diaries %>%  dplyr::select(rec_id,occupation___7,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___7)) %>% dplyr::mutate(id = oc_lbs[8])
oc8 = ex_diaries %>%  dplyr::select(rec_id,occupation___8,genderlb) %>% dplyr::group_by(genderlb) %>%  dplyr::summarise(total = sum(occupation___8)) %>% dplyr::mutate(id = oc_lbs[9])
oc9 = ex_diaries %>%  dplyr::select(rec_id,occupation___9,genderlb) %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(occupation___9))%>% dplyr::mutate(id = oc_lbs[10])

x = rbind(oc0,oc1,oc2,oc3,oc4,oc5,oc6,oc8,oc9)

#### x = x[!is.na(x$genderlb)]

x$id = factor(x$id, levels = c(oc_lbs[1:10]))


x %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Occupation'), yaxis = list(title='Total'))

#x %>% dplyr::mutate(id = forcats::fct_reorder(id, total)) %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
#  plotly::layout(xaxis = list(title= 'Occupation'), yaxis = list(title='Total'))


```

```{r}


### Highest level of education vs Gender

x = ex_diaries %>% dplyr::select(agelb, study_sitelb, genderlb, highest_educ, highest_educlb)%>% 
group_by(genderlb,highest_educlb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Occupation'), yaxis = list(title='Total'))

#x %>% dplyr::mutate(id = forcats::fct_reorder(id, total)) %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
#  plotly::layout(xaxis = list(title= 'Occupation'), yaxis = list(title='Total'))


```



### Completed the diaries alone or by Field worker Vs Average of contacts (Mouse over the bar)

```{r}
#Em relação às respostas da pergunta acima, gostaria também que incluisses  a média de contactos que os participantes que preencheram os diários sozinhos tiveram assim como a média de contactos que os #participantes que tiveram ajuda do trabalhador de campo para preencher.

#ex_hh_ind = ex_hh_ind %>% dplyr::mutate(complbl = case_when(contacts_completedby == 0 ~ "alone during day 1 and 2",
#                                                            contacts_completedby == 1 ~ "by fieldworker at collection day"))

#x = ex_hh_ind %>% dplyr::select(complbl, sexlb,agelb, study_site,study_sitelb) %>% group_by(study_sitelb, complbl) %>% dplyr::summarise(total = n())

#x %>% plotly::plot_ly(x=~complbl, y=~total,  color=~study_sitelb, type = 'bar', colors = 'Accent') %>%
#  plotly::layout(xaxis = list(title= 'Who completed the diaries during day 1 and 2'),yaxis = list(title='Total'))

#xx = ex_contacts1 %>% dplyr::select(rec_id,study_sitelb, complbl, duration_contact_d1) %>% dplyr::group_by(study_sitelb, complbl) %>%

x = ex_contacts1 %>% dplyr::select(rec_id,study_sitelb, complbl, duration_contact_d1) %>% dplyr::group_by(rec_id,study_sitelb, complbl) %>%
  dplyr::summarise(total = n())%>% dplyr::group_by(study_sitelb, complbl) %>% dplyr::summarise(totaln = n(), avg_cont = mean(total))

x$avg_contacts = paste0("Average of contacts: ", round(as.numeric(x$avg_cont),2))

x %>% plotly::plot_ly(x=~complbl, y=~totaln,  color=~study_sitelb,  text =~avg_contacts, textposition = 'auto',  type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Who completed the diaries during day 1 and 2'),yaxis = list(title='Total'))

```


Diaries {data-icon="fa-book"}
===================================== 


Row
----------------------------------------------------------------------


### Day 1 Diaries

```{r}
###fa-list, fa-pen
  
valueBox(dim(diary_1)[1], icon = "fa-list", color = 'danger', href = "#apes")

```


### Diary of Contacts Day 1

```{r}
valueBox(dim(d1_conts)[1], icon = "fa-users", color = 'info', href = "#apes")
```
  
  
### Diary of Place Visited Day 1

```{r}
valueBox(dim(d1_locs)[1], icon = "fa-random", color = 'info', href = "#informantes")
```


### Day 2 Diaries

```{r}
###fa-list, fa-pen
  
valueBox(dim(diary_2)[1], icon = "fa-list", color = 'danger', href = "#apes")

```

### Diary of Contacts Day 2

```{r}
valueBox(dim(d2_conts)[1], icon = "fa-users", color = 'info', href = "#informantes")
```


### Diary of Place Visited Day 2
```{r}
valueBox(dim(d2_locs)[1], icon = "fa-random", color = 'info', href = "#informantes")
```



Row
----------------------------------------------------------------------

### Location Contact Day 1 

```{r}

### c_lbs = c("Minha casa", "Outra casa", "Escola", "Trabalho", "Transporte", "Mercado/Loja/Supermercado", "Na rua", "Poço/Fontanária", "No campo/machamba", "No parque infantil", "No lugar de culto", "Outro")

c_lbs = c("My home", "Other home", "School", "Work", "Transport/ Hub", "Market", "Street", "Well", "Playground", "Shop", "Place of worship", "Garden", "Other")

 
c0 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___0)) %>% dplyr::mutate(id = c_lbs[1])
c1 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___1)) %>% dplyr::mutate(id = c_lbs[2])
c2 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___2)) %>% dplyr::mutate(id = c_lbs[3])
c3 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___3)) %>% dplyr::mutate(id = c_lbs[4])
c4 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___4)) %>% dplyr::mutate(id = c_lbs[5])
c5 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___5)) %>% dplyr::mutate(id = c_lbs[6])
c6 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___6)) %>% dplyr::mutate(id = c_lbs[7])
c7 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___7)) %>% dplyr::mutate(id = c_lbs[8])
c8 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___8)) %>% dplyr::mutate(id = c_lbs[9])
c9 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___9)) %>% dplyr::mutate(id = c_lbs[10])
c10 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___10)) %>% dplyr::mutate(id = c_lbs[11])
c11 = ind_cont1 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d1___11)) %>% dplyr::mutate(id = c_lbs[12])

x = rbind(c0,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)

x$id = factor(x$id, labels = c(c_lbs[1:12]))

x %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Location Contact Day1'), yaxis = list(title='Total'))


```


### Location Contact Day 2 

```{r}

### c_lbs = c("Minha casa", "Outra casa", "Escola", "Trabalho", "Transporte", "Mercado/Loja/Supermercado", "Na rua", "Poço/Fontanária", "No campo/machamba", "No parque infantil", "No lugar de culto", "Outro")

c_lbs = c("My home", "Other home", "School", "Work", "Transport/ Hub", "Market", "Street", "Well", "Playground", "Shop", "Place of worship", "Garden", "Other")
 
c0 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___0)) %>% dplyr::mutate(id = c_lbs[1])
c1 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___1)) %>% dplyr::mutate(id = c_lbs[2])
c2 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___2)) %>% dplyr::mutate(id = c_lbs[3])
c3 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___3)) %>% dplyr::mutate(id = c_lbs[4])
c4 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___4)) %>% dplyr::mutate(id = c_lbs[5])
c5 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___5)) %>% dplyr::mutate(id = c_lbs[6])
c6 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___6)) %>% dplyr::mutate(id = c_lbs[7])
c7 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___7)) %>% dplyr::mutate(id = c_lbs[8])
c8 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___8)) %>% dplyr::mutate(id = c_lbs[9])
c9 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___9)) %>% dplyr::mutate(id = c_lbs[10])
c10 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___10)) %>% dplyr::mutate(id = c_lbs[11])
c11 = ind_cont2 %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(location_contact_d2___11)) %>% dplyr::mutate(id = c_lbs[12])


x = rbind(c0,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)

x$id = factor(x$id, labels = c(c_lbs[1:12]))

x %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Location Contact Day2'), yaxis = list(title='Total'))

```


Row
----------------------------------------------------------------------

### Number of contacts Day 1

```{r}
x = ex_diaries %>% dplyr::select(study_site, study_sitelb,genderlb,num_contact_aim1_d1, agelb)
#%>% dplyr::filter(study_site == 1)

x = x[!is.na(x$num_contact_aim1_d1),]

lbc = c("0 contacts","1 to 3 contacts","4 to 6 contacts","7 to 10 contacts","11 to 15 contacts","> 15 contacts")

x = x %>% dplyr::mutate(mx = case_when(num_contact_aim1_d1 <1 ~ lbc[1],
                                       num_contact_aim1_d1 >=1 & num_contact_aim1_d1 <=3 ~ lbc[2],
                                       num_contact_aim1_d1 > 3 & num_contact_aim1_d1 <=6 ~ lbc[3],
                                       num_contact_aim1_d1 > 6 & num_contact_aim1_d1 <=10 ~ lbc[4],
                                       num_contact_aim1_d1 > 10 & num_contact_aim1_d1 <=15 ~ lbc[5],
                                       num_contact_aim1_d1 > 15 ~ lbc[6]))

x$mx = factor(x$mx, labels = c(lbc[2:6]))

#x$mx = factor(x$mx, levels = 1:6, labels = c("0 contacts","1 to 3 contacts","4 to 6 contacts","7 to 10 contacts","11 to 15 contacts","> 15 contacts"))

                        
x = x %>% dplyr::group_by(agelb) 
#x = x %>% dplyr::group_by(agelb, mx) 
##%>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~num_contact_aim1_d1,  color=~study_sitelb, type = 'box', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Number of contacts Day 1 - Manhiça'), yaxis = list(title='Total # people'))


```



```{r, eval=FALSE}
### Number of contacts Day 1 (Polana Caniço)
x = ex_diaries %>% dplyr::select(study_site, study_sitelb,genderlb,num_contact_aim1_d1, agelb) %>% dplyr::filter(study_site == 2)

x = x[!is.na(x$num_contact_aim1_d1),]

lbc = c("0 contacts","1 to 3 contacts","4 to 6 contacts","7 to 10 contacts","11 to 15 contacts","> 15 contacts")

x = x %>% dplyr::mutate(mx = case_when(num_contact_aim1_d1 <1 ~ lbc[1],
                                       num_contact_aim1_d1 >=1 & num_contact_aim1_d1 <=3 ~ lbc[2],
                                       num_contact_aim1_d1 > 3 & num_contact_aim1_d1 <=6 ~ lbc[3],
                                       num_contact_aim1_d1 > 6 & num_contact_aim1_d1 <=10 ~ lbc[4],
                                       num_contact_aim1_d1 > 10 & num_contact_aim1_d1 <=15 ~ lbc[5],
                                       num_contact_aim1_d1 > 15 ~ lbc[6]))

#x$mx = factor(x$mx, labels = c(lbc[2:6]))

#x$mx = factor(x$mx, levels = 1:6, labels = c("0 contacts","1 to 3 contacts","4 to 6 contacts","7 to 10 contacts","11 to 15 contacts","> 15 contacts"))

                        
x = x %>% dplyr::group_by(agelb) 

#%>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~num_contact_aim1_d1,  color=~agelb, type = 'box', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Number of contacts Day 1 - Polana Caniço'), yaxis = list(title='Total # people'))


```



### Number of contacts Day 2

```{r}
x = ex_diaries %>% dplyr::select(study_site, study_sitelb,genderlb,num_contact_aim1_d2,agelb)  
#%>% dplyr::filter(study_site == 1)

x = x[!is.na(x$num_contact_aim1_d2),]

lbc = c("0 contacts","1 to 3 contacts","4 to 6 contacts","7 to 10 contacts","11 to 15 contacts","> 15 contacts")

x = x %>% dplyr::mutate(mx = case_when(num_contact_aim1_d2 <1 ~ lbc[1],
                                       num_contact_aim1_d2 >=1 & num_contact_aim1_d2 <=3 ~ lbc[2],
                                       num_contact_aim1_d2 > 3 & num_contact_aim1_d2 <=6 ~ lbc[3],
                                       num_contact_aim1_d2 > 6 & num_contact_aim1_d2 <=10 ~ lbc[4],
                                       num_contact_aim1_d2 > 10 & num_contact_aim1_d2 <=15 ~ lbc[5],
                                       num_contact_aim1_d2 > 15 ~ lbc[6]))

x$mx = factor(x$mx, labels = c(lbc[2:6]))
                        
x = x %>% dplyr::group_by(agelb) 
#%>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~num_contact_aim1_d2,  color=~study_sitelb, type = 'box', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Number of contacts Day 2 - Manhiça'), yaxis = list(title='Total # people'))

```



```{r, eval=FALSE}

### Number of contacts Day 2 (Polana Caniço)
x = ex_diaries %>% dplyr::select(study_site, study_sitelb,genderlb,num_contact_aim1_d2,agelb)  %>% dplyr::filter(study_site == 2)

x = x[!is.na(x$num_contact_aim1_d2),]

lbc = c("0 contacts","1 to 3 contacts","4 to 6 contacts","7 to 10 contacts","11 to 15 contacts","> 15 contacts")

x = x %>% dplyr::mutate(mx = case_when(num_contact_aim1_d2 <1 ~ lbc[1],
                                       num_contact_aim1_d2 >=1 & num_contact_aim1_d2 <=3 ~ lbc[2],
                                       num_contact_aim1_d2 > 3 & num_contact_aim1_d2 <=6 ~ lbc[3],
                                       num_contact_aim1_d2 > 6 & num_contact_aim1_d2 <=10 ~ lbc[4],
                                       num_contact_aim1_d2 > 10 & num_contact_aim1_d2 <=15 ~ lbc[5],
                                       num_contact_aim1_d2 > 15 ~ lbc[6]))

x$mx = factor(x$mx, labels = c(lbc[2:6]))
                        
x = x %>% dplyr::group_by(agelb)
#%>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~agelb, y=~num_contact_aim1_d2,  color=~agelb, type = 'box', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Number of contacts Day 2 - Polana Caniço'), yaxis = list(title='Total # people'))

```

Row
----------------------------------------------------------------------

### Place Visited Day 1 

```{r}

x = ind_locs1 %>% dplyr::select(agelb, place_visited_d1,p_d1) %>% dplyr::group_by(p_d1 ,agelb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~p_d1, y=~total,  color=~agelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Places Visited Day1'), yaxis = list(title='Total'))


if(FALSE){
pd1 = ind_locs1 %>% dplyr::select(agelb, place_visited_d1,p_d1) %>% 
  dplyr::group_by(agelb,p_d1) %>% dplyr::summarise(total = n()) %>% 
  dplyr::mutate(prop = round(prop.table(total)*100,2)) %>% dplyr::mutate(id = "place")

pd1$agelb = as.character(pd1$agelb)

pd1$targ = 100 - pd1$prop

x = pd1


x %>% plotly::plot_ly(x=~agelb, y=~prop, type = 'bar', colors = ~p_d1, name = 'Diary Completed') %>%
  plotly::add_trace(y=~targ, colors = ~p_d1, name= 'Not Enrolled') %>% 
  plotly::layout(xaxis = list(title= 'Age Group'),yaxis = list(title='Total'), barmode = 'stack')



td1 = ind_locs1 %>% dplyr::select(agelb, place_visited_d1,time_visited_d1,p_d1) %>% dplyr::group_by(p_d1,agelb) %>% dplyr::summarise(total = sum(time_visited_d1)) %>% dplyr::mutate(prop = round(prop.table(total)*100,2)) %>% dplyr::mutate(id = "time")

td1 = td1 %>% dplyr::select(names(pd1))

x = rbind(td1, pd1)

x = x %>% group_by(p_d1,agelb, id)

x %>% plotly::plot_ly(x=~agelb, y=~prop, type = 'bar', colors = ~p_d1, name = 'Diary Completed', barmode = "stack") %>%
  plotly::add_trace(y=~targ, name= 'Not Enrolled') %>% 
  plotly::add_text(text =~prop, textposition = 'auto', name= 'Show Percentages') %>% 
  plotly::layout(y=~targ,xaxis = list(title= 'Age Group'),yaxis = list(title='Total'), barmode = 'stack')


xxxx = ex_hh_ind %>% dplyr::select(sexlb,agelb, study_site,study_sitelb) %>% dplyr::filter(study_site == 1) %>% 
  group_by(agelb) %>% dplyr::summarise(total = n()) %>% dplyr::mutate(targ = (63*2) - total, perc = paste0(round(total/63*2*100, 2), "%") )

}


```


### Places Visited Day 2 

```{r}

x = ind_locs2 %>% dplyr::select(agelb, place_visited_d2,p_d1) %>% dplyr::group_by(p_d1 ,agelb) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~p_d1, y=~total,  color=~agelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Places Visited Day2'), yaxis = list(title='Total'))


```

Row
----------------------------------------------------------------------


### Time spent on each Location Day1

```{r}
x = ind_locs1 %>% dplyr::select(agelb, place_visited_d1,time_visited_d1,p_d1) %>% dplyr::group_by(agelb, p_d1) %>% dplyr::summarise(total = mean(time_visited_d1))

x %>% plotly::plot_ly(x=~p_d1, y=~total,  color=~agelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Time spent on each Location Day2'), yaxis = list(title='Total Time Spent (Average)'))

```

### Time spent on each Location Day2

```{r}

x = ind_locs2 %>% dplyr::select(agelb, place_visited_d2, time_visited_d2,p_d1) %>% dplyr::group_by(agelb, p_d1) %>% dplyr::summarise(total = mean(time_visited_d2))

x %>% plotly::plot_ly(x=~p_d1, y=~total,  color=~agelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Time spent on each Location Day2'), yaxis = list(title='Total Time Spent (Average)'))

```

Row
----------------------------------------------------------------------


### Approximately number of people in location Day1

```{r}

x = ind_locs1 %>% dplyr::select(agelb, place_visited_d1,time_visited_d1, num_pax_place_d1,p_d1) 

x$num_pax_place_d1 = as.numeric(x$num_pax_place_d1)
x = x[!is.na(x$num_pax_place_d1),]

x = x %>% dplyr::mutate(mx = case_when(num_pax_place_d1 <=3 ~ "1 - 3 persons",
                                       num_pax_place_d1 >3 & num_pax_place_d1 <=10 ~ "4 - 10 persons",
                                       num_pax_place_d1 > 10 & num_pax_place_d1 <=20 ~ "11 - 20 persons",
                                       num_pax_place_d1 > 20 ~ "more than 20 persons"))
                        

x = x %>% dplyr::group_by(p_d1, agelb)
#%>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~p_d1, y=~num_pax_place_d1,  color=~agelb, type = 'box', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Approx # people on location Day1'), yaxis = list(title='Total # people'))

```

### Approximately number of people in location Day2

```{r }
### Time spent on each Location Day1

x = ind_locs2 %>% dplyr::select(agelb, place_visited_d2, time_visited_d2, num_pax_place_d2,p_d1)
  
x$num_pax_place_d2 = as.numeric(x$num_pax_place_d2)
x = x[!is.na(x$num_pax_place_d2),]

x = x %>% dplyr::mutate(mx = case_when(num_pax_place_d2 <=3 ~ "1 - 3 persons",
                                       num_pax_place_d2 >3 & num_pax_place_d2 <=10 ~ "4 - 10 persons",
                                       num_pax_place_d2 > 10 & num_pax_place_d2 <=20 ~ "11 - 20 persons",
                                       num_pax_place_d2 > 20 ~ "more than 20 persons"))
                        

x = x %>% dplyr::group_by(p_d1, agelb)
#%>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~p_d1, y=~num_pax_place_d2,  color=~agelb, type = 'box', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Approx # people on location Day2'), yaxis = list(title='Total # people'))


```


Row
----------------------------------------------------------------------

### Day of the Week for 1st contact diary

```{r}
#Qual foi o dia da semana para o primeiro dia do diário de contato?

x = diary_1 %>% dplyr::select(study_sitelb, survey_day_d1,sd1) %>% dplyr::group_by(study_sitelb,sd1) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~sd1, y=~total,  color=~study_sitelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Day of the Week for 1st contact diary'), yaxis = list(title='total'))

```

### Day of the Week for 2nd contact diary

```{r}
#Qual foi o dia da semana para o primeiro dia do diário de contato?

x = diary_2 %>% dplyr::select(study_sitelb,survey_day_d2,sd2) %>% dplyr::group_by(study_sitelb, sd2) %>% dplyr::summarise(total = n())

x %>% plotly::plot_ly(x=~sd2, y=~total,  color=~study_sitelb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'Day of the Week for 2nd contact diary'), yaxis = list(title='total'))

```

COVID-19
=====================================

Row
----------------------------------------------------------------------


### No, I don't think I need

```{r}
valueBox(dim(ex_hh_ind %>% dplyr::filter(self_covid_test == 0))[1], icon = "fa-archive", color = 'purple', href = "#informantes")
```

### No, didn't have opportunity

```{r}
valueBox(dim(ex_hh_ind %>% dplyr::filter(self_covid_test == 1))[1], icon = "fa-bug", color = 'green', href = "#informantes")
```


### Yes, I tested Positive

```{r}
valueBox(dim(ex_hh_ind %>% dplyr::filter(self_covid_test == 2))[1], icon = "fa-user-plus", color = 'maroon', href = "#informantes")
```

### Yes, I tested negative

```{r}
valueBox(dim(ex_hh_ind %>% dplyr::filter(self_covid_test == 3))[1], icon = "fa-user-minus", color = 'teal', href = "#informantes")
```

### Yes, waiting for results

```{r}
valueBox(dim(ex_hh_ind %>% dplyr::filter(self_covid_test == 4))[1], icon = "fa-hand-paper", color = 'navy', href = "#informantes")
```

### Prefer not answer

```{r}
valueBox(dim(ex_hh_ind %>% dplyr::filter(self_covid_test == 5))[1], icon = "fa-shield", color = 'info', href = "#informantes")
```


Row
----------------------------------------------------------------------


### Had COVID Contacts

```{r}

#contlb =  c("Ninguém","Membro do agregado","Amigo próximo","Colega do trabalho","Paciente (no caso de trabalhador de saúde)","Cliente","Outro","Prefere não responder")
contlb =  c("None that I know","Member of my household","Close friend","Coworker","Patient (in case of a health care worker)","Client / Customer","Other","Rather not respond")


#sct = c("Não, acho que não preciso", "Não, teve a oportunidade", "Sim, eu testei positivo", "Sim, eu testei negativo", "Sim, aguardando resultados", "Prefere não responder")
sct = c("No, I don't think I need", "No, didn't have opportunity", "Yes, tested Positive", "Yes, tested negative", "Yes, waiting for results", "Prefer not answer")

x = ex_hh_ind %>% dplyr::select(rec_id,study_site, study_sitelb, sex, genderlb, self_covid_test, starts_with("covid_contact"), starts_with("current_symptoms")) 

#x = x %>% dplyr::mutate(test_covidlb = case_when(self_covid_test == 0 ~ sct[1], self_covid_test == 1 ~ sct[2], self_covid_test == 2 ~ sct[3], self_covid_test == 3 ~ sct[4],
#                                                 self_covid_test == 4 ~ sct[5], self_covid_test == 5 ~ sct[6]))

c0 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___0)) %>% dplyr::mutate(id = contlb[1])
c1 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___1)) %>% dplyr::mutate(id = contlb[2])
c2 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___2)) %>% dplyr::mutate(id = contlb[3])
c3 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___3)) %>% dplyr::mutate(id = contlb[4])
c4 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___4)) %>% dplyr::mutate(id = contlb[5])
c5 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___5)) %>% dplyr::mutate(id = contlb[6])
c6 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___6)) %>% dplyr::mutate(id = contlb[7])
c7 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(covid_contact___7)) %>% dplyr::mutate(id = contlb[8])

x = rbind(c0,c1,c2,c3,c4,c5,c6,c7)
x$id = factor(x$id, labels = c(contlb[1:8]))

x %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'COVID Contacts in last 14 days'), yaxis = list(title='Total'))


```



### Had COVID Symptoms

```{r}

#symplb =  c("Difculdade de respirar","Desconforto no peito","Arrepios","Tosse","Febre","Dor na garganta","Perda de paladar ou olfato","Dores musculares ou articulares","Cansaço ou exaustão","Náuseas #ou vómitos","Diarreia","Nenhum dos indicados acima")
symplb =  c("Difficulty in breathing","Chest discomfort","Chills","Cough","Fever","Sore throat","Loss of taste or smell","Muscle or joint paints","Tiredness or exhaustion","Nausea or vomiting","Diarrhea","None of these")

#sct = c("Não, acho que não preciso", "Não, teve a oportunidade", "Sim, eu testei positivo", "Sim, eu testei negativo", "Sim, aguardando resultados", "Prefere não responder")
sct = c("No, I don't think I need", "No, didn't have opportunity", "Yes, tested Positive", "Yes, tested negative", "Yes, waiting for results", "Prefer not answer")

x = ex_hh_ind %>% dplyr::select(rec_id,study_site, study_sitelb, sex, genderlb, self_covid_test, starts_with("covid_contact"), starts_with("current_symptoms")) 

#x = x %>% dplyr::mutate(test_covidlb = case_when(self_covid_test == 0 ~ sct[1], self_covid_test == 1 ~ sct[2], self_covid_test == 2 ~ sct[3], self_covid_test == 3 ~ sct[4],
#                                                 self_covid_test == 4 ~ sct[5], self_covid_test == 5 ~ sct[6]))


symp0 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___0)) %>% dplyr::mutate(id = symplb[1])
symp1 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___1)) %>% dplyr::mutate(id = symplb[2])
symp2 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___2)) %>% dplyr::mutate(id = symplb[3])
symp3 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___3)) %>% dplyr::mutate(id = symplb[4])
symp4 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___4)) %>% dplyr::mutate(id = symplb[5])
symp5 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___5)) %>% dplyr::mutate(id = symplb[6])
symp6 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___6)) %>% dplyr::mutate(id = symplb[7])
symp7 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___7)) %>% dplyr::mutate(id = symplb[8])
symp8 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___8)) %>% dplyr::mutate(id = symplb[9])
symp9 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___9)) %>% dplyr::mutate(id = symplb[10])
symp10 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___10)) %>% dplyr::mutate(id = symplb[11])
symp11 = x %>% dplyr::group_by(genderlb) %>% dplyr::summarise(total = sum(current_symptoms___11)) %>% dplyr::mutate(id = symplb[12])

x = rbind(symp0,symp1,symp2,symp3,symp4,symp5,symp6,symp7,symp8,symp9,symp10,symp11)
x$id = factor(x$id, labels = c(symplb[1:12]))


x %>% plotly::plot_ly(x=~id, y=~total,  color=~genderlb, type = 'bar', colors = 'Accent') %>%
  plotly::layout(xaxis = list(title= 'COVID Symptoms in last 14 days'), yaxis = list(title='Total'))



```


Incidents
=====================================

```{r}
inc = rio::import("../dashboardfiles/incidents.xlsx")

man = inc %>% dplyr::filter(site == 1) 

pc = inc %>% dplyr::filter(site == 2) 

```

Row
----------------------------------------------------------------------

### Manhiça Incidents

```{r}
x= man%>% dplyr::summarise(total = sum(total))
valueBox(x$total, icon = "fa-archive", color = 'purple', href = "#informantes")
```

### Polana Caniço Incidents

```{r}
x = pc %>% dplyr::summarise(total = sum(total))
valueBox(x$total, icon = "fa-bug", color = 'green', href = "#informantes")
```


Row
----------------------------------------------------------------------

### Manhiça Incidents before Recruitment

```{r}

x = man %>% dplyr::filter(time == 0) %>% dplyr::group_by(timelb, incident) %>% summarise(total = sum(total))

x %>% plotly::plot_ly(labels = ~incident, values=~total, color=~timelb, type = 'pie',text =~total, texttemplate = '<b>%{value}</br></br>%{percent}</b>', 
             textfont = list(color = '#000000')) %>%  
  layout(title = 'Manhiça Incidents before Recruitment',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

### Polana Caniço before Recruitment

```{r}

x = pc %>% dplyr::filter(time == 0) %>% dplyr::group_by(timelb, incident) %>% summarise(total = sum(total))

x %>% plotly::plot_ly(labels = ~incident, values=~total, color=~timelb, type = 'pie',text =~total, texttemplate = '<b>%{value}</br></br>%{percent}</b>', 
             textfont = list(color = '#000000')) %>% 
  layout(title = 'Polana Caniço before Recruitment',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```


Row
----------------------------------------------------------------------

### Manhiça Incidents after Recruitment

```{r}

x = man %>% dplyr::filter(time == 1) %>% dplyr::group_by(timelb, incident) %>% summarise(total = sum(total))

x %>% plotly::plot_ly(labels = ~incident, values=~total, color=~timelb, type = 'pie',text =~total, texttemplate = '<b>%{value}</br></br>%{percent}</b>', 
             textfont = list(color = '#000000')) %>%  
  layout(title = 'Manhiça Incidents after Recruitment',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```


### Polana Caniço Incidents after Recruitment

```{r}

x = pc %>% dplyr::filter(time == 0) %>% dplyr::group_by(timelb, incident) %>% summarise(total = sum(total))

x %>% plotly::plot_ly(labels = ~incident, values=~total, color=~timelb, type = 'pie',text =~total, texttemplate = '<b>%{value}</br></br>%{percent}</b>', 
             textfont = list(color = '#000000')) %>%  
  layout(title = 'Polana Caniço Incidents after Recruitment',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

```

Details
=====================================  

Row
-------------------------------------
  

### Country Data Management and Visualization (CISM)

```{r}
valueBox('Corssino J. Tchavana', icon = "fa-database",
         href="mailto:corssinojaime@gmail.com?Subject=asam%20dashboard")
```

### Country Data Management (CISPOC)

```{r}
valueBox('Nilzio Bento Cavele', icon = "fa-database",
         href="mailto:nbcavelee@gmail.com?Subject=asam%20dashboard", color = 'info')
```

### Country Principal Investigator and Approver

```{r}
valueBox('Charfudin Sacoor', icon = "fa-eye",
         href="charfudin.sacoor@manhica.net?Subject=asam%20dashboard")
```


Row
-------------------------------------
  

### Coordinating institutions

```{r}
valueBox('CISM - CISPOC', icon = "fa-users",
         href="#", color = 'warning')
```




```{r, echo=FALSE, eval=FALSE}

#### https://fontawesome.com/icons?d=gallery&p=2&q=quiet



```
