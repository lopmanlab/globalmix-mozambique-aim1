---
title: "02a_individual_analysis"
author: "M. Kiti"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    # number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, comment = NA)

rm(list=ls())

source("./scripts/00_load_libraries.R")
# source("../scripts/00b_useful_functions.R")
```

## Analysis of participant data


```{r participant, include=FALSE, warning=FALSE}
participant <- readRDS("./Data/individual_info.RDS")

# DataExplorer::create_report(participant)

# cols with 100% missing data, to drop: redcap_repeat_instrument, sex_other.

# cols to be checked: child_breastfeed, occupation_other
```

```{r factorize, echo=FALSE, include=FALSE}
participant$study_site <- as.factor(participant$study_site) 
```

```{r baseline, echo=FALSE, warning=FALSE}
label(participant$sex) <- "Sex"
label(participant$age) <- "Age"
label(participant$age_cat) <- "Age group"
label(participant$read_write) <- "Can you read and write?"
label(participant$enrolled_school) <- "Currently enrolled in school"
label(participant$highest_educ) <- "Highest education level attained (currently not in school)"
label(participant$school_level) <- "School level (currently in school)"
label(participant$transport_use) <- "Transport use last 3 months"
# label(participant$) <- ""
# label(participant$) <- ""
# label(participant$) <- ""
# label(participant$) <- ""

t1 <- participant %>%
  filter(aim==1) %>%
  select(sex, age_cat, read_write, enrolled_school, school_level, highest_educ, study_site) %>%
  tbl_summary(by=study_site, 
              percent="column",
              digits = all_categorical() ~ 0,
              missing="no") %>%
  add_overall() %>%
  bold_labels() %>%
  modify_header(label = "") %>%
  # modify_spanning_header(c("stat_1", "stat_2", "stat_3") ~ "**Survey round**") %>%
  modify_caption("**Table 1: Baseline characteristics of Aim 1 participants across sites**")

t2 <- participant %>%
  filter(aim==2) %>%
  select(sex, age_cat, read_write, enrolled_school, school_level, highest_educ, study_site) %>%
  tbl_summary(by=study_site, 
              percent="column",
              digits = all_categorical() ~ 0,
              missing="no") %>%
  add_overall() %>%
  bold_labels() %>%
  modify_header(label = "") %>%
  # modify_spanning_header(c("stat_1", "stat_2", "stat_3") ~ "**Survey round**") %>%
  modify_caption("**Table 2: Baseline characteristics of Aim 2 participants across sites**")
```

```{r aim1_summary}
t1
```

```{r aim2_summary}
t2
```


```{r}
contact_rural_all <- readRDS("./Data/contact_rural_all.RDS")

contact_rural_all$hh_membership <- factor(contact_rural_all$hh_membership,
                                          levels = c("Member", "Non-member")) 
t3 <- contact_rural_all %>%
  # filter(aim==1) %>%
  select(age_group_contact, contact_sex, contact_mask, known_contact, duration_contact, 
         frequency_contact, where_contact, hh_membership) %>%
  tbl_summary(by=hh_membership, 
              percent="row",
              digits = all_categorical() ~ 0,
              missing="no") %>%
  add_overall() %>%
  bold_labels() %>%
  modify_header(label = "") %>%
  # modify_spanning_header(c("stat_1", "stat_2", "stat_3") ~ "**Survey round**") %>%
  modify_caption("**Table 3: Baseline characteristics of contacts**")
t3
```